generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model usuario {
  id                   Int                   @id @default(autoincrement())
  nome                 String
  email                String                @unique
  senha                String
  cargo                String
  telefone             String?
  instituicaoId        Int?
  instituicao          instituicao?          @relation(fields: [instituicaoId], references: [id])
  aceitaPerto          Boolean?
  createdAt            DateTime              @default(now())
  updatedAt            DateTime              @updatedAt
  instituicaoDestino   instituicaoDestino[]
  imagePerfil          Bytes?
  solicitacaoSolicitante solicitacao[]         @relation("solicitacaoSolicitante")
  solicitacaoAlvo      solicitacao[]         @relation("solicitacaoAlvo")
  topicos topico[]
  comentarios comentario[]
}

model instituicao {
  id      Int                  @id
  nome    String?
  municipio String?
  uf      String?
  sigla   String?
  usuario instituicaoDestino[]
  usuarios usuario[]
}

model instituicaoDestino {
  usuarioId     Int
  instituicaoId Int
  instituicao   instituicao? @relation(fields: [instituicaoId], references: [id])
  usuario       usuario      @relation(fields: [usuarioId], references: [id])

  @@id([usuarioId, instituicaoId])
}

model solicitacao {
  id                    Int      @id @default(autoincrement())
  status                status   @default(Pendente)
  createdAt             DateTime @default(now())
  usuarioSolicitante    usuario  @relation("solicitacaoSolicitante", fields: [usuarioId_solicitante], references: [id])
  usuarioId_solicitante Int
  usuarioAlvo           usuario  @relation("solicitacaoAlvo", fields: [usuarioId_alvo], references: [id])
  usuarioId_alvo        Int
}

enum status {
  Pendente
  Aceita
  Rejeitada
}

model topico {
  id Int @id @default(autoincrement())
  nome String
  comentarios comentario[]
  categoria String
  createdAt            DateTime              @default(now())
  id_usuario Int
  usuario       usuario      @relation(fields: [id_usuario], references: [id])
}


model comentario{
  id Int @id @default(autoincrement())
  id_usuario Int
  usuario       usuario      @relation(fields: [id_usuario], references: [id])
  descricao String
  topico topico @relation(fields:[id_topico], references: [id], onDelete: Cascade)
  id_topico Int
  createdAt            DateTime              @default(now())
  updatedAt            DateTime              @default(now ())
}




